@extends('layouts.app')

@section('title', 'System Configuration')
@section('page-title', 'System Configuration')

/**
@section('sidebar-menu')
    {{-- Admin Menu Items (SHARED) --}}
    <a href="{{ route('admin.dashboard') }}" class="nav-link">
        <i class="bi bi-speedometer2"></i> Dashboard
    </a>
    <a href="{{ route('admin.bookings.pending') }}" class="nav-link">
        <i class="bi bi-hourglass-split"></i> Pending Queue
    </a>
    <a href="{{ route('admin.bookings.index') }}" class="nav-link">
        <i class="bi bi-calendar-check"></i> All Bookings
    </a>
    <a href="{{ route('admin.departments.index') }}" class="nav-link">
        <i class="bi bi-hospital"></i> Departments
    </a>
    <a href="{{ route('admin.schedules.index') }}" class="nav-link">
        <i class="bi bi-calendar3"></i> Schedules
    </a>
    
    {{-- Divider --}}
    <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 1.5rem;">
    
    {{-- Super Admin Exclusive Items --}}
    <a href="{{ route('super-admin.users.index') }}" class="nav-link">
        <i class="bi bi-people"></i> Manage Users
    </a>
    <a href="{{ route('super-admin.config.edit') }}" class="nav-link active">
        <i class="bi bi-gear"></i> System Config
    </a>
@endsection
*/
@section('sidebar-menu')
    <a href="{{ route('admin.dashboard') }}" class="nav-link">
        <i class="bi bi-speedometer2"></i> Dashboard
    </a>
    <a href="{{ route('admin.bookings.pending') }}" class="nav-link">
        <i class="bi bi-hourglass-split"></i> Pending Queue
    </a>
    <a href="{{ route('admin.bookings.index') }}" class="nav-link">
        <i class="bi bi-calendar-check"></i> All Bookings
    </a>
    <a href="{{ route('admin.schedules.index') }}" class="nav-link">
        <i class="bi bi-calendar3"></i> Schedules
    </a>
    
    @if(auth()->user()->isSuperAdmin())
        <a href="{{ route('admin.departments.index') }}" class="nav-link">
            <i class="bi bi-hospital"></i> Departments
        </a>
        
        <hr style="border-color: rgba(255,255,255,0.2); margin: 1rem 1.5rem;">
        
        <a href="{{ route('super-admin.users.index') }}" class="nav-link">
            <i class="bi bi-people"></i> Manage Users
        </a>
        <a href="{{ route('super-admin.config.edit') }}" class="nav-link">
            <i class="bi bi-gear"></i> System Config
        </a>
    @endif
@endsection

@section('content')
<div class="card">
    <div class="card-header">
        <h5 class="mb-0"><i class="bi bi-gear"></i> System Configuration</h5>
    </div>

    <div class="card-body">
        <form action="{{ route('super-admin.config.update') }}" method="POST">
            @csrf
            @method('PUT')

            {{-- Booking Rules Section --}}
            <div class="mb-4">
                <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-calendar-check"></i> Booking Rules</h6>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="booking_advance_days" class="form-label">
                            Booking Advance Days *
                            <small class="text-muted d-block">How many days in advance can representatives book?</small>
                        </label>
                        <input type="number"
                               class="form-control @error('booking_advance_days') is-invalid @enderror"
                               id="booking_advance_days"
                               name="booking_advance_days"
                               value="{{ old('booking_advance_days', $config['booking_advance_days'] ?? 7) }}"
                               min="1"
                               max="90"
                               required>
                        @error('booking_advance_days')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="cooldown_period_days" class="form-label">
                            Cooldown Period (Days) *
                            <small class="text-muted d-block">Days to wait after approved booking before next booking</small>
                        </label>
                        <input type="number"
                               class="form-control @error('cooldown_period_days') is-invalid @enderror"
                               id="cooldown_period_days"
                               name="cooldown_period_days"
                               value="{{ old('cooldown_period_days', $config['cooldown_period_days'] ?? 7) }}"
                               min="0"
                               max="365"
                               required>
                        @error('cooldown_period_days')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="max_concurrent_bookings" class="form-label">
                            Max Concurrent Bookings *
                            <small class="text-muted d-block">Maximum pending bookings per representative</small>
                        </label>
                        <input type="number"
                               class="form-control @error('max_concurrent_bookings') is-invalid @enderror"
                               id="max_concurrent_bookings"
                               name="max_concurrent_bookings"
                               value="{{ old('max_concurrent_bookings', $config['max_concurrent_bookings'] ?? 3) }}"
                               min="1"
                               max="10"
                               required>
                        @error('max_concurrent_bookings')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="min_booking_notice_hours" class="form-label">
                            Minimum Booking Notice (Hours) *
                            <small class="text-muted d-block">Minimum hours before appointment time</small>
                        </label>
                        <input type="number"
                               class="form-control @error('min_booking_notice_hours') is-invalid @enderror"
                               id="min_booking_notice_hours"
                               name="min_booking_notice_hours"
                               value="{{ old('min_booking_notice_hours', $config['min_booking_notice_hours'] ?? 24) }}"
                               min="1"
                               max="168"
                               required>
                        @error('min_booking_notice_hours')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- System Settings Section --}}
            <div class="mb-4">
                <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-globe"></i> System Settings</h6>
                
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="system_timezone" class="form-label">
                            System Timezone *
                        </label>
                        <select class="form-select @error('system_timezone') is-invalid @enderror"
                                id="system_timezone"
                                name="system_timezone"
                                required>
                            <option value="Asia/Kuwait" {{ old('system_timezone', $config['system_timezone'] ?? 'Asia/Kuwait') == 'Asia/Kuwait' ? 'selected' : '' }}>
                                Asia/Kuwait (UTC+3)
                            </option>
                            <option value="UTC" {{ old('system_timezone', $config['system_timezone'] ?? '') == 'UTC' ? 'selected' : '' }}>
                                UTC
                            </option>
                        </select>
                        @error('system_timezone')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>

                    <div class="col-md-6 mb-3">
                        <label for="app_name" class="form-label">
                            Application Name *
                        </label>
                        <input type="text"
                               class="form-control @error('app_name') is-invalid @enderror"
                               id="app_name"
                               name="app_name"
                               value="{{ old('app_name', $config['app_name'] ?? 'Pharmacy Booking System') }}"
                               required>
                        @error('app_name')
                            <div class="invalid-feedback">{{ $message }}</div>
                        @enderror
                    </div>
                </div>
            </div>

            {{-- Notification Settings Section --}}
            <div class="mb-4">
                <h6 class="border-bottom pb-2 mb-3"><i class="bi bi-bell"></i> Notification Settings</h6>
                
                <div class="row">
                    <div class="col-md-12 mb-3">
                        <div class="form-check">
                            <input type="checkbox"
                                   class="form-check-input"
                                   id="enable_email_notifications"
                                   name="enable_email_notifications"
                                   value="1"
                                   {{ old('enable_email_notifications', $config['enable_email_notifications'] ?? true) ? 'checked' : '' }}>
                            <label class="form-check-label" for="enable_email_notifications">
                                Enable Email Notifications
                                <small class="text-muted d-block">Send emails for booking status changes</small>
                            </label>
                        </div>
                    </div>
                </div>
            </div>

            {{-- Action Buttons --}}
            <div class="d-flex gap-2">
                <button type="submit" class="btn btn-primary">
                    <i class="bi bi-check-circle"></i> Save Configuration
                </button>
                <button type="reset" class="btn btn-secondary">
                    <i class="bi bi-arrow-counterclockwise"></i> Reset
                </button>
            </div>
        </form>
    </div>
</div>

{{-- Current Configuration Preview --}}
<div class="card mt-3">
    <div class="card-header">
        <h6 class="mb-0"><i class="bi bi-info-circle"></i> Current Configuration</h6>
    </div>
    <div class="card-body">
        <div class="row">
            <div class="col-md-6">
                <dl class="row mb-0">
                    <dt class="col-sm-6">Booking Advance Days:</dt>
                    <dd class="col-sm-6">{{ $config['booking_advance_days'] ?? 7 }} days</dd>
                    
                    <dt class="col-sm-6">Cooldown Period:</dt>
                    <dd class="col-sm-6">{{ $config['cooldown_period_days'] ?? 7 }} days</dd>
                    
                    <dt class="col-sm-6">Max Concurrent:</dt>
                    <dd class="col-sm-6">{{ $config['max_concurrent_bookings'] ?? 3 }} bookings</dd>
                </dl>
            </div>
            <div class="col-md-6">
                <dl class="row mb-0">
                    <dt class="col-sm-6">Min Notice:</dt>
                    <dd class="col-sm-6">{{ $config['min_booking_notice_hours'] ?? 24 }} hours</dd>
                    
                    <dt class="col-sm-6">Timezone:</dt>
                    <dd class="col-sm-6">{{ $config['system_timezone'] ?? 'Asia/Kuwait' }}</dd>
                    
                    <dt class="col-sm-6">Email Notifications:</dt>
                    <dd class="col-sm-6">
                        <span class="badge bg-{{ ($config['enable_email_notifications'] ?? true) ? 'success' : 'danger' }}">
                            {{ ($config['enable_email_notifications'] ?? true) ? 'Enabled' : 'Disabled' }}
                        </span>
                    </dd>
                </dl>
            </div>
        </div>
    </div>
</div>
@endsection
